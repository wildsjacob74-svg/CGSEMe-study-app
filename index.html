<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GCSE Study App</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f0f8ff; }
h1, h2 { color: #2a52be; }
#appContent { display: none; }
.lesson { cursor: pointer; padding: 5px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; }
.completed { text-decoration: line-through; color: gray; }
button { padding: 5px 10px; margin-top: 10px; }
</style>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<h1>GCSE Study App</h1>

<!-- Sign Up / Login Form -->
<div id="authDiv">
<h2>Sign Up</h2>
<input type="email" id="signupEmail" placeholder="Email"><br>
<input type="password" id="signupPassword" placeholder="Password"><br>
<button id="signupBtn">Sign Up</button>

<h2>Log In</h2>
<input type="email" id="loginEmail" placeholder="Email"><br>
<input type="password" id="loginPassword" placeholder="Password"><br>
<button id="loginBtn">Log In</button>
</div>

<!-- Main App Content -->
<div id="appContent">
<h2>Welcome, <span id="userEmail"></span>!</h2>
<h3>Your Lessons:</h3>
<ul id="lessonsList"></ul>
<button id="logoutBtn">Log Out</button>
</div>

<script>
// ---- Your Firebase config ----
const firebaseConfig = {
apiKey: "AIzaSyB2TBtyxW3S_pu745Sq73CFA_7ICQAcQZM",
authDomain: "gcsme-1a488.firebaseapp.com",
projectId: "gcsme-1a488",
storageBucket: "gcsme-1a488.firebasestorage.app",
messagingSenderId: "116760620980",
appId: "1:116760620980:web:f5abb4592a643631c74ce1"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ---- Sample Lessons ----
const lessons = [
{ id: 'math1', title: 'Math Basics' },
{ id: 'eng1', title: 'English Grammar' },
{ id: 'sci1', title: 'Science Fundamentals' }
];

// ---- DOM Elements ----
const authDiv = document.getElementById('authDiv');
const appContent = document.getElementById('appContent');
const lessonsList = document.getElementById('lessonsList');
const userEmailSpan = document.getElementById('userEmail');

// ---- Sign Up ----
document.getElementById('signupBtn').onclick = () => {
const email = document.getElementById('signupEmail').value;
const password = document.getElementById('signupPassword').value;
auth.createUserWithEmailAndPassword(email, password)
.then(cred => {
alert('Sign up successful!');
showDashboard(cred.user);
})
.catch(err => alert(err.message));
};

// ---- Log In ----
document.getElementById('loginBtn').onclick = () => {
const email = document.getElementById('loginEmail').value;
const password = document.getElementById('loginPassword').value;
auth.signInWithEmailAndPassword(email, password)
.then(cred => {
showDashboard(cred.user);
})
.catch(err => alert(err.message));
};

// ---- Log Out ----
document.getElementById('logoutBtn').onclick = () => {
auth.signOut().then(() => {
appContent.style.display = 'none';
authDiv.style.display = 'block';
});
};

// ---- Show Dashboard ----
function showDashboard(user) {
authDiv.style.display = 'none';
appContent.style.display = 'block';
userEmailSpan.textContent = user.email;

lessonsList.innerHTML = ''; // clear current lessons

// Load user progress from Firestore
const userRef = db.collection('users').doc(user.uid);
userRef.get().then(doc => {
let progress = {};
if(doc.exists) progress = doc.data().progress || {};

lessons.forEach(lesson => {
const li = document.createElement('li');
li.textContent = lesson.title;
li.className = 'lesson';
if(progress[lesson.id]) li.classList.add('completed');

li.onclick = () => {
progress[lesson.id] = !progress[lesson.id]; // toggle complete
li.classList.toggle('completed');
userRef.set({ progress: progress }, { merge: true });
};

lessonsList.appendChild(li);
});
}).catch(err => console.error(err));
}

// ---- Auto-login if already signed in ----
auth.onAuthStateChanged(user => {
if(user) showDashboard(user);
});
</script>
</body>
</html>
