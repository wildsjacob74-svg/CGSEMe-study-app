<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GCSE Study App</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f8ff; padding: 20px; }
h1, h2 { color: #2a52be; }
#appContent { display: none; }
.lesson, .flashcard { cursor: pointer; padding: 5px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; }
.completed { text-decoration: line-through; color: gray; }
button { padding: 5px 10px; margin-top: 10px; margin-right: 5px; }
#flashcardForm { margin-top: 10px; }
#subjects button { margin-right: 5px; margin-bottom: 5px; }
#studyCard { border: 1px solid #2a52be; padding: 20px; border-radius: 10px; width: 300px; height: 150px; text-align: center; margin: 10px 0; font-size: 18px; background: #fff; }
.progress { font-size: 14px; color: #333; margin-bottom: 10px; }
.quiz-question { font-size: 18px; margin: 10px 0; }
.quiz-option { padding: 5px; margin: 5px 0; border: 1px solid #ccc; cursor: pointer; }
.quiz-option.selected { background-color: #2a52be; color: white; }
.quiz-result { margin-top: 15px; font-size: 18px; color: green; }
</style>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<h1>GCSE Study App</h1>

<!-- Authentication -->
<div id="authDiv">
<h2>Sign Up</h2>
<input type="email" id="signupEmail" placeholder="Email"><br>
<input type="password" id="signupPassword" placeholder="Password"><br>
<button id="signupBtn">Sign Up</button>

<h2>Log In</h2>
<input type="email" id="loginEmail" placeholder="Email"><br>
<input type="password" id="loginPassword" placeholder="Password"><br>
<button id="loginBtn">Log In</button>
</div>

<!-- Main App -->
<div id="appContent">
<h2>Welcome, <span id="userEmail"></span>!</h2>
<button id="logoutBtn">Log Out</button>

<!-- Subjects / Lessons -->
<h3>Subjects</h3>
<div id="subjects"></div>
<div id="subjectProgress" class="progress"></div>
<ul id="lessonsList"></ul>

<!-- Flashcards -->
<h3>Flashcards</h3>
<div id="flashcardsList"></div>
<div id="flashcardForm">
<input type="text" id="flashcardQuestion" placeholder="Question">
<input type="text" id="flashcardAnswer" placeholder="Answer">
<button id="addFlashcardBtn">Add Flashcard</button>
</div>

<!-- Study Mode -->
<h3>Study Flashcards</h3>
<div id="studyCard" style="display:none;"></div>
<button id="prevCard" style="display:none;">Previous</button>
<button id="nextCard" style="display:none;">Next</button>
<button id="flipCard" style="display:none;">Show Answer</button>

<!-- Quiz Section -->
<h3>Quiz: <span id="quizTitle"></span></h3>
<div id="quizContainer" style="display:none;">
<div id="quizQuestion" class="quiz-question"></div>
<div id="quizOptions"></div>
<button id="nextQuizBtn" style="display:none;">Next Question</button>
<div id="quizResult" class="quiz-result"></div>
</div>
</div>

<script>
// ---- Firebase Configuration ----
const firebaseConfig = {
apiKey: "AIzaSyB2TBtyxW3S_pu745Sq73CFA_7ICQAcQZM",
authDomain: "gcsme-1a488.firebaseapp.com",
projectId: "gcsme-1a488",
storageBucket: "gcsme-1a488.firebasestorage.app",
messagingSenderId: "116760620980",
appId: "1:116760620980:web:f5abb4592a643631c74ce1"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ---- Subjects & Lessons ----
const data = {
"Math": [
{ id: 'math1', title: 'Algebra Basics' },
{ id: 'math2', title: 'Geometry Essentials' },
{ id: 'math3', title: 'Probability & Statistics' }
],
"English": [
{ id: 'eng1', title: 'Grammar Fundamentals' },
{ id: 'eng2', title: 'Essay Writing' },
{ id: 'eng3', title: 'Comprehension Skills' }
],
"Science": [
{ id: 'sci1', title: 'Biology Basics' },
{ id: 'sci2', title: 'Chemistry Concepts' },
{ id: 'sci3', title: 'Physics Fundamentals' }
]
};

// ---- DOM Elements ----
const authDiv = document.getElementById('authDiv');
const appContent = document.getElementById('appContent');
const lessonsList = document.getElementById('lessonsList');
const subjectsDiv = document.getElementById('subjects');
const userEmailSpan = document.getElementById('userEmail');
const flashcardsList = document.getElementById('flashcardsList');
const studyCardDiv = document.getElementById('studyCard');
const prevBtn = document.getElementById('prevCard');
const nextBtn = document.getElementById('nextCard');
const flipBtn = document.getElementById('flipCard');
const subjectProgressDiv = document.getElementById('subjectProgress');
const quizTitleSpan = document.getElementById('quizTitle');
const quizContainer = document.getElementById('quizContainer');
const quizQuestionDiv = document.getElementById('quizQuestion');
const quizOptionsDiv = document.getElementById('quizOptions');
const nextQuizBtn = document.getElementById('nextQuizBtn');
const quizResultDiv = document.getElementById('quizResult');

let studyCards = [];
let currentIndex = 0;
let showingAnswer = false;
let currentSubject = null;
let currentLesson = null;
let currentQuiz = null;
let currentQuizIndex = 0;
let userQuizAnswers = [];

// ---- Authentication ----
document.getElementById('signupBtn').onclick = () => {
const email = document.getElementById('signupEmail').value;
const password = document.getElementById('signupPassword').value;
auth.createUserWithEmailAndPassword(email, password)
.then(cred => showDashboard(cred.user))
.catch(err => alert(err.message));
};

document.getElementById('loginBtn').onclick = () => {
const email = document.getElementById('loginEmail').value;
const password = document.getElementById('loginPassword').value;
auth.signInWithEmailAndPassword(email, password)
.then(cred => showDashboard(cred.user))
.catch(err => alert(err.message));
};

document.getElementById('logoutBtn').onclick = () => {
auth.signOut().then(() => {
appContent.style.display = 'none';
authDiv.style.display = 'block';
});
};

// ---- Dashboard ----
function showDashboard(user) {
authDiv.style.display = 'none';
appContent.style.display = 'block';
userEmailSpan.textContent = user.email;

// Show subjects
subjectsDiv.innerHTML = '';
Object.keys(data).forEach(subject => {
const btn = document.createElement('button');
btn.textContent = subject;
btn.onclick = () => loadLessons(subject, user);
subjectsDiv.appendChild(btn);
});

loadFlashcards(user);
}

// ---- Lessons & Progress ----
function loadLessons(subject, user) {
lessonsList.innerHTML = '';
currentSubject = subject;
const userRef = db.collection('users').doc(user.uid);
userRef.get().then(doc => {
let progress = {};
if(doc.exists) progress = doc.data().progress || {};

data[subject].forEach(lesson => {
const li = document.createElement('li');
li.textContent = lesson.title;
li.className = 'lesson';
if(progress[lesson.id]) li.classList.add('completed');
li.onclick = () => {
currentLesson = lesson.id;
startQuiz(user, lesson.id);
};
lessonsList.appendChild(li);
});

updateProgressDisplay(user);
});
}

function updateProgressDisplay(user) {
if(!currentSubject) return;
const userRef = db.collection('users').doc(user.uid);
userRef.get().then(doc => {
let progress = {};
if(doc.exists) progress = doc.data().progress || {};
const lessons = data[currentSubject];
const completedCount = lessons.filter(l => progress[l.id]).length;
const percent = Math.round((completedCount / lessons.length) * 100);
subjectProgressDiv.textContent = `Progress in ${currentSubject}: ${percent}%`;
});
}

// ---- Quiz Section ----
function startQuiz(user, lessonId) {
currentQuizIndex = 0;
userQuizAnswers = [];
quizResultDiv.style.display = 'none';
quizContainer.style.display = 'block';
const quizRef = db.collection('lessons').doc(lessonId).collection('quizzes');
quizRef.get().then(snapshot => {
currentQuiz = snapshot.docs.map(doc => doc.data());
quizTitleSpan.textContent = data[currentSubject].find(lesson => lesson.id === lessonId).title;
showQuizQuestion();
});
}

function showQuizQuestion() {
if (currentQuizIndex >= currentQuiz.length) {
showQuizResults();
return;
}

const quiz = currentQuiz[currentQuizIndex];
quizQuestionDiv.textContent = quiz.question;
quizOptionsDiv.innerHTML = '';
quiz.options.forEach(option => {
const optionDiv = document.createElement('div');
optionDiv.className = 'quiz-option';
optionDiv.textContent = option;
optionDiv.onclick = () => selectAnswer(option);
quizOptionsDiv.appendChild(optionDiv);
});

nextQuizBtn.style.display = 'none';
}

function selectAnswer(selectedOption) {
userQuizAnswers[currentQuizIndex] = selectedOption;
const options = quizOptionsDiv.querySelectorAll('.quiz-option');
options.forEach(option => option.classList.remove('selected'));
const selectedDiv = Array.from(options).find(option => option.textContent === selectedOption);
selectedDiv.classList.add('selected');
nextQuizBtn.style.display = 'inline';
}

nextQuizBtn.onclick = () => {
currentQuizIndex++;
showQuizQuestion();
};

function showQuizResults() {
quizContainer.style.display = 'none';
const correctAnswers = currentQuiz.filter((quiz, index) => quiz.answer === userQuizAnswers[index]).length;
const totalQuestions = currentQuiz.length;
quizResultDiv.innerHTML = `You scored ${correctAnswers} out of ${totalQuestions}`;
quizResultDiv.style.display = 'block';
}

// ---- Flashcards ----
function loadFlashcards(user) {
flashcardsList.innerHTML = '';
const flashcardsRef = db.collection('users').doc(user.uid).collection('flashcards');
flashcardsRef.get().then(snapshot => {
studyCards = [];
snapshot.forEach(doc => {
const fc = doc.data();
studyCards.push({ id: doc.id, question: fc.question, answer: fc.answer });
const div = document.createElement('div');
div.className = 'flashcard';
div.innerHTML = `<strong>Q:</strong> ${fc.question} <br> <strong>A:</strong> ${fc.answer}`;
div.onclick = () => {
if(confirm('Delete this flashcard?')) {
flashcardsRef.doc(doc.id).delete().then(() => loadFlashcards(user));
}
};
flashcardsList.appendChild(div);
});
setupStudyMode();
});
}

document.getElementById('addFlashcardBtn').onclick = () => {
const question = document.getElementById('flashcardQuestion').value.trim();
const answer = document.getElementById('flashcardAnswer').value.trim();
const user = auth.currentUser;
if(!question || !answer) { alert('Enter both question and answer'); return; }
const flashcardsRef = db.collection('users').doc(user.uid).collection('flashcards');
flashcardsRef.add({ question, answer }).then(() => {
document.getElementById('flashcardQuestion').value = '';
document.getElementById('flashcardAnswer').value = '';
loadFlashcards(user);
});
};

// ---- Auto-login if already signed in ----
auth.onAuthStateChanged(user => { if(user) showDashboard(user); });
</script>
</body>
</html>
